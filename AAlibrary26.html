<!DOCTYPE html>
<html>
<head>
<title>Library Management System</title>

<style>
body{
    margin:0;
    font-family:Arial;
    background:#f2f2f2;
}
header{
    background:#007bff;
    color:#fff;
    padding:15px;
    display:flex;
    justify-content:space-between;
    flex-wrap:wrap;
}
header input,header button{
    padding:6px;
    margin:2px;
}
.inpall{
    width: 98%;
    padding: 6px;
    margin: 5px;
}
form,.section{
    background:#fff;
    margin:20px;
    padding:15px;
    border-radius:10px;
}
table{
    width:95%;
    margin:auto;
    border-collapse:collapse;
    background:#fff;
}
th,td{
    border:1px solid #007bff;
    padding:8px;
    text-align:center;
}
th{
    background:#007bff;
    color:white;
}
button{
    cursor:pointer;
    font-size: 15px;
}
.delete-btn{
    background:red;
    color:white;
    border:none;
    padding:5px;
}
label{
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    
}
footer{
    background:#007bff;
    color:white;
    text-align:center;
    padding:10px;
    margin-top:30px;
}
#finebtn{
     color: white;
     background: gray;
     font-family: Cascadia Mono;
     margin-left: 5px;
     padding: 5px;
     margin: 5px;
     border-radius: 8%;
}

</style>
</head>

<body>

<header>
<h3>Welcome</h3>
<div id="headdiv">
<input id="searchInput" placeholder="Student ID">
<button onclick="searchBook()">Search</button>
<button onclick="showAll()">Show All</button>
<button onclick="logout()">Logout</button>
</div>
</header>

<form id="bookForm">
<label>Student ID</label>
<input id="studentId" required class="inpall">

<label>Student Name</label>
<input id="studentName" required class="inpall">

<label>Course</label>
<input id="course" required class="inpall">

<label>Book ID</label>
<input id="bookId" class="inpall">

<label>Book Name</label>
<input id="bookName" class="inpall">

<label>Author Name</label>
<input id="author" class="inpall">

<label>Issue Date</label>
<input type="date" id="issueDate" required class="inpall">

<label>Return Date</label>
<input type="date" id="returnDate" required class="inpall">

<button type="submit" id="finebtn" >Add Book</button>
</form>

<table>
<thead>
<tr>
<th>Student ID</th><th>Name</th><th>Course</th>
<th>Book ID</th><th>Book</th><th>Author</th>
<th>Issue</th><th>Return</th><th>Action</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>

<!-- LATE FINE SECTION -->
<div class="section">
<h2>Late Fine</h2>

<div class="inputs">
<input id="fineStudentId" placeholder="Enter Student ID" class="inpall">
<button onclick="searchFineBooks()" id="finebtn">Search Books</button>
</div>

<br>

<table>
<thead>
<tr>
<th>Book ID</th>
<th>Book Name</th>
<th>Expected Return</th>
<th>Select</th>
</tr>
</thead>
<tbody id="fineBookList"></tbody>
</table>

<br>

<div class="inputs">
<label>Expected Date</label>
<input type="date" id="expectedDate" readonly class="inpall">

<label>Actual Date</label>
<input type="date" id="actualDate" class="inpall">

<button onclick="calculateFine()" id="finebtn">Calculate Fine</button>
</div>

<div class="inputs">
<label>Late Days</label>
<input id="lateDays" readonly class="inpall">

<label>Fine</label>
<input id="fineAmount" readonly class="inpall">
</div>
</div>

<!-- FINAL DETAILS -->
<div class="section">
<h2>Final Fine Details</h2>
<div class="inputs">
<label>Student ID</label>
<input id="finalStudentId" readonly class="inpall">

<label>Book ID</label>
<input id="finalBookId" readonly class="inpall">

<label>Book Name</label>
<input id="finalBookName" readonly class="inpall">

<label>Actual Return Date</label>
<input id="finalActualDate" readonly class="inpall">

<label>Fine Amount</label>
<input id="finalFine" readonly class="inpall">
</div>
</div>

<footer>Â© Library Management System</footer>

<script>

let books = JSON.parse(localStorage.getItem("books")) || [];
let selectedBook = null;

function displayBooks(list = books){
    tableBody.innerHTML="";
    list.forEach((b,i)=>{
        tableBody.innerHTML += `
        <tr>
            <td>${b.studentId}</td>
            <td>${b.studentName}</td>
            <td>${b.course}</td>
            <td>${b.bookId}</td>
            <td>${b.bookName}</td>
            <td>${b.author}</td>
            <td>${b.issueDate}</td>
            <td>${b.returnDate}</td>
            <td><button class="delete-btn" onclick="deleteBook(${i})">Delete</button></td>
        </tr>`;
    });
}
displayBooks();

bookForm.onsubmit = e =>{
    e.preventDefault();
    books.push({
        studentId:studentId.value,
        studentName:studentName.value,
        course:course.value,
        bookId:bookId.value,
        bookName:bookName.value,
        author:author.value,
        issueDate:issueDate.value,
        returnDate:returnDate.value
    });
    localStorage.setItem("books",JSON.stringify(books));
    bookForm.reset();
    displayBooks();
};

function deleteBook(i){
    books.splice(i,1);
    localStorage.setItem("books",JSON.stringify(books));
    displayBooks();
}

function searchBook(){
    displayBooks(books.filter(b=>b.studentId===searchInput.value.trim()));
}
function showAll(){displayBooks();}

function logout(){
    alert("Logged out");
    localStorage.removeItem("loggedUser");
    localStorage.removeItem("isLoggedIn");
    window.location.href="f1.html";
}

/* LATE FINE MULTI BOOK SEARCH */
function searchFineBooks(){
    fineBookList.innerHTML="";
    let id=fineStudentId.value.trim();
    let result=books.filter(b=>b.studentId===id);

    if(result.length===0){
        alert("No books found");
        return;
    }

    result.forEach((b)=>{
        fineBookList.innerHTML+=`
        <tr>
            <td>${b.bookId}</td>
            <td>${b.bookName}</td>
            <td>${b.returnDate}</td>
            <td><button onclick='selectFineBook(${JSON.stringify(b)})'>Select</button></td>
        </tr>`;
    });
}

/* SELECT BOOK */
function selectFineBook(b){
    selectedBook=b;
    expectedDate.value=b.returnDate;
    finalStudentId.value=b.studentId;
    finalBookId.value=b.bookId;
    finalBookName.value=b.bookName;
}

/* CALCULATE FINE */
function calculateFine(){
    if(!selectedBook || !actualDate.value){
        alert("Select book & date");
        return;
    }
    let exp=new Date(expectedDate.value);
    let act=new Date(actualDate.value);
    let days=Math.ceil((act-exp)/(1000*60*60*24));
    days=days>0?days:0;
    let fine=days*5;

    lateDays.value=days;
    fineAmount.value=fine;
    finalActualDate.value=actualDate.value;
    finalFine.value=fine;
}
</script>

</body>
</html>
